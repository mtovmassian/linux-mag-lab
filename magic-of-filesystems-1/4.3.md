# 4.3. *union* filesystems

⚠️ The following examples are using **OverlayFS** rather than **aufs** which is no longer supported.

1. Create the test directory sturcture:
```shell
mkdir -p fstest/ && cd fstest/
mkdir -p dir1/subdir dir2/subdir dir_union
touch dir1/subdir/file1 dir2/subdir/file2
```
2. Create necessary OverlayFS upper and working directories:
```shell
mkdir upper work
```
3. Mount OverlayFS filesystem:
```shell
sudo mount -t overlay overlay -o lowerdir=dir1:dir2,upperdir=upper,workdir=work dir_union
```
- Note: the second *overlay* after `-t overlay` is a fake device name (could be *no_device* for instance)
4. Check the result:
```shell
ls dir_union/
subdir
ls dir_union/subdir/
file1  file2
``` 
- OverlayFS merges the two directories dir1 and dir2 into a single unified read-only view: **dir_union**
5. Create files under **dir_union**:
```shell
touch dir_union/subdir/toto
ls dir_union/subdir/
file1  file2  toto

ls dir1/subdir dir2/subdir
dir1/subdir:
file1

dir2/subdir:
file2

ls upper/subdir/
toto
```
- File creation is not reflected in lower directories **dir1** or **dir2** but in upper directory **upper**
6. Edit files under **dir_union**:
```shell
echo "abcdef" >> dir_union/subdir/file1
cat dir_union/subdir/file1
abcdef
cat dir1/subdir/file1
cat upper/subdir/file1
abcdef
```
- File edition is not reflected in lower directories **dir1** or **dir2** but in upper directory **upper**
7. Unount and remount OverlayFS filesystem in read-only mode i.e. without upper directory and working directory:
```shell
sudo umount dir_union
sudo mount -t overlay overlay -o lowerdir=dir1:dir2 dir_union
```
8. Try to create files under **dir_union**:
```shell
touch dir_union/subdir/toto2
touch: cannot touch 'dir_union/subdir/toto2': Read-only file system
```